{% extends "base.html" %}

{% block content %}
<h1>Status</h1>
<table class="status-table">
    <tr>
        <td class="status-label">Battery Status</td>
        <td id="battery-voltage" class="status-value">Loading...</td>
        <td id="battery-current" class="status-value">Loading...</td>
        <td id="battery-charge-level" class="status-value">Loading...</td>
    </tr>
    <tr>
        <td class="status-label">Solar Panel Status</td>
        <td id="solar-voltage" class="status-value">Loading...</td>
        <td id="solar-current" class="status-value">Loading...</td>
    </tr>
    <tr>
        <td class="status-label">Speed</td>
        <td id="speed" class="status-value">Loading...</td>
    </tr>
    <tr>
        <td class="status-label">Heading</td>
        <td id="heading" class="status-value">Loading...</td>
    </tr>
    <tr>
        <td class="status-label">Temperature</td>
        <td id="temperature" class="status-value">Loading...</td>
    </tr>
    <tr>
        <td class="status-label">Humidity</td>
        <td id="humidity" class="status-value">Loading...</td>
    </tr>
    <tr>
        <td class="status-label">Pressure</td>
        <td id="pressure" class="status-value">Loading...</td>
    </tr>
    <tr>
        <td class="status-label">Left Distance</td>
        <td id="left-distance" class="status-value">Loading...</td>
    </tr>
    <tr>
        <td class="status-label">Right Distance</td>
        <td id="right-distance" class="status-value">Loading...</td>
    </tr>
    <tr>
        <td class="status-label">Mowing status</td>
        <td class="status-value">{{ mowing_status }}</td>
    </tr>
    <tr>
        <td class="status-label">Next scheduled mow</td>
        <td class="status-value">{{ next_scheduled_mow }}</td>
    </tr>
</table>
<img id="video" src="{{ url_for('video_feed') }}" />

    <script>
        function updateSensorData() {
            // Make an AJAX request to retrieve the updated sensor data
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var sensorData = JSON.parse(xhr.responseText);
                        // Update the sensor data in the HTML elements
                        document.getElementById('battery-voltage').textContent = sensorData.battery_voltage.bus_voltage + ' V';
                        document.getElementById('battery-current').textContent = sensorData.battery_voltage.current + ' A';
                        document.getElementById('battery-charge-level').textContent = sensorData.battery_voltage.charge_level;
                        document.getElementById('solar-voltage').textContent = sensorData.solar_voltage.bus_voltage + ' V';
                        document.getElementById('solar-current').textContent = sensorData.solar_voltage.current + ' A';
                        document.getElementById('speed').textContent = sensorData.speed + ' mph';
                        document.getElementById('heading').textContent = sensorData.heading + ' degrees';
                        document.getElementById('temperature').textContent = sensorData.temperature + ' Â°F';
                        document.getElementById('humidity').textContent = sensorData.humidity + ' %';
                        document.getElementById('pressure').textContent = sensorData.pressure + ' hPa';
                        document.getElementById('left-distance').textContent = sensorData.left_distance + ' cm';
                        document.getElementById('right-distance').textContent = sensorData.right_distance + ' cm';
                    } else {
                        console.error('Error retrieving sensor data');
                    }
                }
            };
            xhr.open('GET', '/sensor-data', true);
            xhr.send();
        }

        // Update sensor data every 5 seconds
        setInterval(updateSensorData, 5000);
    </script>
{% endblock %}
