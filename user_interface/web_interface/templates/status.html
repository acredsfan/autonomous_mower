{% extends "base.html" %}

{% block content %}
    <h1>Status</h1>
    <div class="status-grid">
        <div class="status-item">
            <span class="status-label">Battery Status</span>
            <span id="battery-voltage" class="status-value">Loading...</span>
            <span id="battery-current" class="status-value">Loading...</span>
            <span id="battery-charge-level" class="status-value">Loading...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Solar Panel Status</span>
            <span id="solar-voltage" class="status-value">Loading...</span>
            <span id="solar-current" class="status-value">Loading...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Speed</span>
            <span id="speed" class="status-value">Loading...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Heading</span>
            <span id="heading" class="status-value">Loading...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Temperature</span>
            <span id="temperature" class="status-value">Loading...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Humidity</span>
            <span id="humidity" class="status-value">Loading...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Pressure</span>
            <span id="pressure" class="status-value">Loading...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Left Distance</span>
            <span id="left-distance" class="status-value">Loading...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Right Distance</span>
            <span id="right-distance" class="status-value">Loading...</span>
        </div>
        <div class="status-item">
            <span class="status-label">Mowing status</span>
            <span class="status-value">{{ mowing_status }}</span>
        </div>
        <div class="status-item">
            <span class="status-label">Next scheduled mow</span>
            <span class="status-value">{{ next_scheduled_mow }}</span>
        </div>
    </div>
    <img id="video" src="{{ url_for('video_feed') }}" />
    <script>
        function updateSensorData() {
            // Make an AJAX request to retrieve the updated sensor data
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var sensorData = JSON.parse(xhr.responseText);
                        // Update the sensor data in the HTML elements
                        document.getElementById('battery-voltage').textContent = sensorData.battery_voltage.bus_voltage + ' V';
                        document.getElementById('battery-current').textContent = sensorData.battery_voltage.current + ' A';
                        document.getElementById('battery-charge-level').textContent = sensorData.battery_voltage.charge_level;
                        document.getElementById('solar-voltage').textContent = sensorData.solar_voltage.bus_voltage + ' V';
                        document.getElementById('solar-current').textContent = sensorData.solar_voltage.current + ' A';
                        document.getElementById('speed').textContent = sensorData.speed + ' mph';
                        document.getElementById('heading').textContent = sensorData.heading + ' degrees';
                        document.getElementById('temperature').textContent = sensorData.temperature + ' Â°F';
                        document.getElementById('humidity').textContent = sensorData.humidity + ' %';
                        document.getElementById('pressure').textContent = sensorData.pressure + ' hPa';
                        document.getElementById('left-distance').textContent = sensorData.left_distance + ' cm';
                        document.getElementById('right-distance').textContent = sensorData.right_distance + ' cm';
                    } else {
                        console.error('Error retrieving sensor data');
                    }
                }
            };
            xhr.open('GET', '/sensor-data', true);
            xhr.send();
        }

        // Update sensor data every 5 seconds
        setInterval(updateSensorData, 5000);
    </script>
{% endblock %}
