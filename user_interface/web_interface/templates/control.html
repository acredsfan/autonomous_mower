{% extends "base.html" %}

{% block content %}
    <h1>Control</h1>
    <div class="main-content">
        <div class="control-panel">
            <div class="controller">
                <button class="btn btn-up" onclick="move('forward')"><i class="fas fa-arrow-up"></i></button>
                <button class="btn btn-left" onclick="move('left')"><i class="fas fa-arrow-left"></i></button>
                <button class="btn btn-down" onclick="move('backward')"><i class="fas fa-arrow-down"></i></button>
                <button class="btn btn-right" onclick="move('right')"><i class="fas fa-arrow-right"></i></button>
                <button class="btn btn-stop" onclick="move('stop')"><i class="fas fa-stop"></i></button>
            </div>
            <div class="mower-controls">
                <button class="btn btn-blades-on" onclick="toggleBlades('on')"><i class="fas fa-power-off"></i></button>
                <button class="btn btn-blades-off" onclick="toggleBlades('off')"><i class="fas fa-ban"></i></button>
                <button class="btn btn-start-mowing" onclick="startMowing()">Start Mowing</button>
                <button class="btn btn-stop-mowing" onclick="stopMowing()">Stop Mowing</button>
            </div>
        </div>
        <div class="video-stream">
            <img id="video_feed" src="/video_feed">
        </div>
    </div>

    <script>
        // Existing Socket.IO code
        socket.on('message', function(data) {
            console.log(data.data);
        });


        // JavaScript functions for controlling the robot
        function move(direction) {
            let steering = 0;
            let throttle = 0;

            switch (direction) {
                case 'forward':
                    throttle = 1; // Full forward
                    break;
                case 'backward':
                    throttle = -1; // Full backward
                    break;
                case 'left':
                    steering = -1; // Full left
                    break;
                case 'right':
                    steering = 1; // Full right
                    break;
                case 'stop':
                    throttle = 0;
                    steering = 0;
                    break;
                default:
                    throttle = 0;
                    steering = 0;
            }

            fetch('/control', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    steering: steering,
                    throttle: throttle
                }),
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch((error) => console.error('Error:', error));
        }

        function toggleBlades(state) {
            fetch('/toggle_blades', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ state: state }),
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch((error) => console.error('Error:', error));
        }

        function startMowing() {
            fetch('/start-mowing', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch((error) => console.error('Error:', error));
        }

        function stopMowing() {
            fetch('/stop-mowing', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch((error) => console.error('Error:', error));
        }
    </script>
{% endblock %}