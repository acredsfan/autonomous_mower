# AGENTS.md

A guide for OpenAI **Codex** and other AI agents working in the `autonomous_mower` repository.
The goal is clear: help Aaron (a beginnerâ€‘level Python developer) ship safe, readable, and wellâ€‘tested code for a RaspberryÂ Pi powered lawn mower.

---

## 1â€¯â€“â€¯Quickâ€‘start commands (Codex will run these automatically)

### Install & set up

```bash
./install_requirements.sh    # installs Python deps & system packages
pre-commit install           # installs git hooks
```

### Style / lint

```bash
pre-commit run --all-files   # Black, isort, flake8, ruff, prettier
```

### Type check

```bash
mypy src/                    # strictÂ â†’ fail on any typing error
```

### Tests

```bash
pytest -q                    # fast unit tests only
pytest -m "integration"      # when task touches hardwareâ€‘facing code
```

---

## 2â€¯â€“â€¯Coding guidelines

| Topic              | Rule                                                                                                  |
| ------------------ | ----------------------------------------------------------------------------------------------------- |
| **Python version** | Target **3.11**; use `matchâ€‘case`, `typing.Annotated`, etc.                                           |
| **Formatting**     | Always run **Black** (line lengthÂ =Â 100).                                                             |
| **Imports**        | Order with **isort** (sections: stdlib, thirdâ€‘party, project).                                        |
| **Type hints**     | Mandatory for all public functions & methods. Use `typing` & `pydantic` for data models.              |
| **Strings**        | Prefer fâ€‘strings.                                                                                     |
| **Logging**        | Use the central `src/core/logger.py`; never `print()`.                                                |
| **Functions**      | â‰¤Â 50Â LOC, single responsibility, docstring with example usage.                                        |
| **Tests**          | Follow _Arrangeâ€‘Actâ€‘Assert_; mock GPIO/serial using `pytest-mock`.                                    |
| **Safety**         | Any code touching motors or blades **must respect** `USE_SIMULATION` env var (defaultÂ =`true` in CI). |
| **Dependencies**   | Add to `pyproject.toml`Â +Â `requirements.lock`; avoid systemâ€‘level installs unless already scripted.   |

---

## 3â€¯â€“â€¯Directory map (for easier navigation)

| Path              | Purpose                                                             |
| ----------------- | ------------------------------------------------------------------- |
| `src/navigation/` | Wayâ€‘point logic, path planning, and wheelâ€‘encoder helpers.          |
| `src/hardware/`   | IÂ²C, UART, and GPIO drivers. Hardware mocks live in `tests/mocks/`. |
| `src/vision/`     | YOLOv8Â TFLite inference & image processing.                         |
| `scripts/`        | Bash helpers used by CI/CD, installer, and Wiâ€‘Fi watchdog.          |
| `docs/`           | Architecture diagrams and developer guides.                         |

---

## 4â€¯â€“â€¯Allowed task types for Codex

1. **BugÂ fix** â€“ green tests must stay green.
2. **Refactor** â€“ improve readability/maintainability without changing behaviour.
3. **FeatureÂ add** â€“ only when explicitly requested by a GitHub issue or TODO.
4. **TestÂ write** â€“ increase coverage; aim for 80â€¯%+ lines.
5. **Docs** â€“ update README, inâ€‘line docs, or `docs/*.md`.

Codex should _not_ touch: deployment manifests, secrets, or hardware PWM/ESC timings unless instructed.

---

## 5â€¯â€“â€¯Pullâ€‘request template (autoâ€‘generated by Codex)

```md
### Summary

<short explanation>

### Test Plan

- [ ] `pytest -q` passes
- [ ] `pytest -m integration` passes (if hardware mocked)
- [ ] `pre-commit run --all-files` clean

### Checklist

- [ ] Code formatted with Black
- [ ] Type hints complete
- [ ] Docs updated
```

---

## 6â€¯â€“â€¯Getting unstuck

If Codex encounters missing dependencies or cannot import a hardwareâ€‘specific library during testing:

1. **Fallback to mocks** provided in `tests/mocks/`.
2. If no mock exists, create a lightweight stub that matches the public API.
3. Document the assumption in the PR description.

---

## 7â€¯â€“â€¯Learning nudges for Aaron

When introducing new patterns or libraries, include a _Beginner Tip_ comment in the PR to explain _why_ it was chosen and link to a minimal example.

---

## 8â€¯â€“â€¯Continuous Integration

GitHub Actions will run the same install/lint/typeâ€‘check/test commands above on every PR. Codex should iterate until CI passes.

---

## 9â€¯â€“â€¯Security & Safety

- Never hardâ€‘code API keys or Wiâ€‘Fi credentials. Load from `.env` or `os.getenv()`.
- Ensure any external network calls have timeouts and retries.
- Respect `EMERGENCY_STOP_PIN` by defaulting motors to **disabled** state on boot unless `EMERGENCY_STOP_PIN` is not enabled.

---

## 10â€¯â€“â€¯Whitespace rules

- Use LF line endings.
- No trailing whitespace.
- End every file with a newline.

---

ðŸ‘‹ **Thanks, Codex!** Keep the mower blades sharp and the code even sharper.
